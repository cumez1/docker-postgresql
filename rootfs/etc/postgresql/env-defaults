#!/usr/bin/with-contenv bash

# shellcheck disable=SC2034
PG_COMMAND=${PG_COMMAND:-/usr/bin/postgres}
PG_VERSION=$(${PG_COMMAND} --version | awk '{print $3}')
PG_VERSION_SLUG=$(${PG_COMMAND} --version | awk '{print $3}' | grep -o -E '[0-9]{1,2}\.[0-9]{1,2}')

PG_HOME="${HOME}/data"
PG_DATA_DIR="${PG_HOME}/$(${PG_COMMAND} --version | awk '{print $3}' | grep -o -E '[0-9]{1,2}\.[0-9]{1,2}')/main"
PG_INIT_DB="${HOME}/init.db.d"
PG_CERTS_DIR="${HOME}/certs"
PG_LOG_DIR="${HOME}/logs"
PG_RUN_DIR=/var/run/postgresql
PG_TIMEOUT_STARTUP=${PG_TIMEOUT_STARTUP:-60}
PG_TIMEOUT_SHUTDOWN=${PG_TIMEOUT_SHUTDOWN:-60}

PG_CONF=${PG_DATA_DIR}/postgresql.conf
PG_HBA_CONF=${PG_DATA_DIR}/pg_hba.conf
PG_IDENT_CONF=${PG_DATA_DIR}/pg_ident.conf
PG_RECOVERY_CONF=${PG_DATA_DIR}/recovery.conf

# SSL/TLS
# Off by default; please not even if the certificates are found in the PG_CERTS_DIR
# SSL/TLS will only be activated wit
PG_SSL=${PG_SSL:-off}

# Replication
REPLICATION_MODE=${REPLICATION_MODE:-$PSQL_MODE} # backward compatibility
REPLICATION_USER=${REPLICATION_USER:-}
REPLICATION_PASS=${REPLICATION_PASS:-}
REPLICATION_HOST=${REPLICATION_HOST:-}
REPLICATION_PORT=${REPLICATION_PORT:-5432}
REPLICATION_SSLMODE=${REPLICATION_SSLMODE:-prefer}

# Postgresql Root User
PG_USER=${PG_USER:-postgres}
PG_PASS=${PG_PASS:-postgres}

# Database
DB_NAME=${DB_NAME:-}
DB_USER=${DB_USER:-}
DB_PASS=${DB_PASS:-}
DB_TEMPLATE=${DB_TEMPLATE:-template1}

# Extensions
DB_EXTENSION=${DB_EXTENSION:-}
PL_PERL=${PL_PERL:-false}
PL_PYTHON=${PL_PYTHON:-false}
PL_TCL=${PL_TCL:-false}

# pg_cron extension
PG_CRON=${PG_CRON:-false}
PG_CRON_DB=${PG_CRON_DB:-postgres}
PG_CRON_WORKERS_BACKGROUND=${PG_CRON_WORKERS_BACKGROUND:-off}
PG_CRON_WORKERS_MAX=${PG_CRON_WORKERS_MAX:-8}


# Journal
PG_JOURNAL_WAL_LEVEL=${PG_JOURNAL_WAL_LEVEL:-minimal}
PG_JOURNAL_WAL_KEEP_SEGMENTS=${PG_JOURNAL_WAL_KEEP_SEGMENTS:-32}
PG_JOURNAL_MAX_SENDERS=${PG_JOURNAL_MAX_SENDERS:-0}
PG_JOURNAL_CHECKPOINT_SEGMENTS=${PG_JOURNAL_CHECKPOINT_SEGMENTS:-8}


# EOF